@using System.Drawing
@using ufshop.Shared
@using ufshop.Services
@namespace ufshop.Components.UI
@rendermode InteractiveServer
@* @inject ufshop.Services.BeService BeService *@



@code {

    public readonly BeService beService;
    public readonly OrderShopService Service;

    //BEGIN Form bindings
    string Prefix { get; set; } = string.Empty;
    string Company { get; set; } = string.Empty;
    string Email { get; set; } = string.Empty;
    string Phone { get; set; } = string.Empty;
    @* string CompanyType { get; set; } = string.Empty; *@
    bool CompanyTypeUF { get; set; } = false;
    bool CompanyTypeNotUF { get; set; } = false;
    bool Assisted { get; set; } = false;
    private bool IsFormDataValid { get { return Service.IsFormDataValid(Prefix, Company, Email, Phone); } }
    //END Form bindings

    private bool IsPrefixValid { get { return Service.IsValidPrefix(Prefix); } }

    private string PrefixCSS
    {
        get
        {
            string output = "margin:0;padding:0;text-align:right;";
            if (Prefix.Length > 0)
            {
                if (!IsPrefixValid)
                {
                    output += "border-color: red;";
                }
                else
                {
                    output += "border-color: green;";
                }
            }

            return output;
        }
    }

    public OrderShop(BeService srv)
    {
        beService = srv;
        Service = new OrderShopService(beService);
    }

    private void MakeOrder()
    {
        string companytype = string.Empty;
        if (CompanyTypeUF)
        {
            companytype = "uf";
        }
        else
        {
            companytype = "other";
        }
        if (IsFormDataValid && Service.MakeOrder(Prefix, Company, Email, Phone, companytype, Assisted))
        {
            //navigate to "order success blabla"
            //or hide form and show info
        }
    }

}
<div class="order-form">

    @* Shop namn och länk *@
    <section class="mb-4">
        <label class="form-label fw-semibold">
            <i class="bi bi-globe me-2"></i>Namn UF-shop
        </label>

        <div class="input-group input-group-lg">
            <span class="input-group-text bg-light border-end-0">https://</span>
            
            <input @bind="Prefix"
                   type="text"
                   pattern="[a-z]{16}"
                   class="form-control border-start-0 border-end-0 text-center"
                   placeholder="uf-namn"
                   style="@PrefixCSS"
            />            
            <span class="input-group-text bg-light border-start-0">.ufshop.nu</span>
        </div>

        <small class="text-muted d-block mt-2">
            <i class="bi bi-info-circle me-1"></i>Endast små bokstäver, inga mellanslag
        </small>
    </section>


    @* Företags namn *@
    <section class="mb-4">
        <label class="form-label fw-semibold">
            <i class="bi bi-building me-2"></i>Företagsnamn
        </label>
        <InputText @bind-Value="Company" 
                    class="form-control form-control-lg" 
                    placeholder="Ditt företagsnamn"/>
    </section>
    
    @* Kontakt information *@
    <section class="card border-0 bg-light mb-4">
        <div class="card-body p-4">
            <h6 class="fw-semibold mb-3 text-muted">
                <i class="bi bi-person-lines-fill me-2"></i>KONTAKTINFORMATION
            </h6>

            <!-- Email -->
            <div class="mb-3">
                <label class="form-label fw-semibold">E-post adress</label>
                <div class="input-group">
                    <span class="input-group-text bg-white">
                        <i class="bi bi-envelope"></i>
                    </span>
                    <InputText @bind-Value="Email" 
                               type="email" 
                               class="form-control" 
                               placeholder="din@email.se" />
                </div>
            </div>

            <!-- Phone -->
            <div class="mb-0">
                <label class="form-label fw-semibold">Mobilnummer</label>
                <div class="input-group">
                    <span class="input-group-text bg-white">
                        <i class="bi bi-telephone"></i>
                    </span>
                    <InputText @bind-Value="Phone" 
                               class="form-control" 
                               placeholder="07X-XXX XX XX" />
                </div>
            </div>


        </div>
    </section>

    @* Typ av företag *@
    <section class="mb-4">
        <label class="form-label fw-semibold mb-3">
            <i class="bi bi-briefcase me-2"></i>Typ av företag
        </label>
        <div class="row g-3">
            <div class="col-6">
                <div class="form-check-card">
                    <input type="radio" 
                           name="shopType" 
                           id="typeUF" 
                           class="form-check-input" 
                           @bind="CompanyTypeUF" />
                    <label class="form-check-label w-100 p-3 text-center" for="typeUF">
                        <i class="bi bi-mortarboard-fill d-block fs-3 mb-2 text-primary"></i>
                        <strong>UF-företag</strong>
                    </label>
                </div>
            </div>
            <div class="col-6">
                <div class="form-check-card">
                    <input type="radio" 
                           name="shopType" 
                           id="typeOther" 
                           class="form-check-input" 
                           @bind="CompanyTypeNotUF" />
                    <label class="form-check-label w-100 p-3 text-center" for="typeOther">
                        <i class="bi bi-building-fill d-block fs-3 mb-2 text-primary"></i>
                        <strong>Annat</strong>
                    </label>
                </div>
            </div>
        </div>
    </section>

    @* Assisterad *@
    <section class="mb-4">
        <div class="card border-0 bg-light">
            <div class="card-body p-3">
                <div class="d-flex align-items-center justify-content-between mx-4">
                    <div>
                        <label class="form-check-label fw-semibold" for="assistedCheck">
                            <i class="bi bi-people-fill me-2 text-primary"></i>Assisterad setup
                        </label>
                        <small class="text-muted d-block mt-1 ">
                            Vi hjälper dig att komma igång med din butik
                        </small>
                    </div>
                    <div class="form-check form-switch">
                        <CheckboxInput @bind-value="Assisted" 
                                    class="form-check-input" 
                                    id="assistedCheck" 
                                    Label="" />
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Submit Button -->
    <section class="d-grid">
        <Button Color="ButtonColor.Success" 
                Size="ButtonSize.Large"
                @onclick="MakeOrder" 
                Disabled="!IsFormDataValid"
                class="btn-submit">
            <i class="bi bi-check-circle-fill me-2"></i>Beställ nu
        </Button>
    </section>
</div>


<style>
    .order-form {
        margin: 0 auto;
    }
    
    .input-group-text {
        font-weight: 500;
    }
    
    .form-control:focus,
    .form-check-input:focus {
        border-color: var(--bs-primary);
    }
    
    /* Radio Card Styles */
    .form-check-card {
        position: relative;
    }
    
    .form-check-card .form-check-input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }
    
    .form-check-card .form-check-label {
        border: 2px solid #dee2e6;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
    }
    
    .form-check-card .form-check-label:hover {
        border-color: var(--bs-primary);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }
    
    .form-check-card .form-check-input:checked + .form-check-label {
        @* border-color: #var(--bs-primary); *@
        background: rgba(13, 110, 253, 0.05);
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
    }
    
    .form-check-card .form-check-input:checked + .form-check-label i {
        color: #var(--bs-primary) !important;
    }
    
    /* Switch Styling */
    .form-check-switch .form-check-input {
        width: 3rem;
        height: 1.5rem;
        cursor: pointer;
    }
    
    .form-check-switch .form-check-input:checked {
        background-color: #198754;
        border-color: #198754;
    }
    
    /* Button Styling */
    .btn-submit {
        font-weight: 600;
        padding: 0.75rem 2rem;
        transition: all 0.3s ease;
    }
    
    .btn-submit:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(25, 135, 84, 0.3);
    }
    
    .btn-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    /* Card Hover Effects */
    .card {
        transition: all 0.3s ease;
    }
    
    /* Input Group Styling */
    .input-group-lg .input-group-text {
        font-size: 1rem;
    }
</style>